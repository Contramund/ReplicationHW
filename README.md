# ReplicationHW

Пока что работа в прогрессе, но скоро все буит

## Общая структура проекта: 

* `main.go` -- парсит аргументы командной строки, затем инициирует менеджер транзакций, клиента и сервер репликации
* `storage.go` -- реализация менеджера транзакций: транзакции принимает через канал (так как много писателей), читатели обращаются напрямую к менеджеру, RWMutex аннигилирует все проблемы с гонками
* `server.go` -- реализация сервера репликации: обслуживает все запросы по заданным роутам
* `transaction.go` -- просто структурка одной транзакции
* `index.html` -- формочка, чтобы удобно было потом отлаживать. По идее после копиляции должна автоматически встроиться в бинарник.

## Что нужно доделать:
* Парсинг аргументов коммандной строки, сделаю скорее всего через `flags` как то
* Сама репликация: часть с upstream каналом идейно готова (нужно будет отладить), нужно обработать роут `ws`. Для этого планируется из тела запроса получить локальное время спрашивающего, а затем собрать один большой json patch из журнала транзакций, который опишет все, что с данного нам времени изменилось
* Обработка роута `/post`: будет смотреть на локальный счетчик входящих и просто пихать транзакцию в поток
* Верификация: посчитать простенький хеш от конкатенации отсортированных пиров, запихнуть в глобальную переменную и передавать через http атрибут для проверки
* Оптимизировать upstream канал: сейчас он непрерывно спрашивает нет ли изменений, на самом деле нужно поставить rate limiter, чтобы спрашивать не чаще чем раз в секунду, например
